<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BudgetTrack Create Account</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    @keyframes blob {
      0%, 100% { transform: translate(0px, 0px) scale(1); }
      33% { transform: translate(30px, -50px) scale(1.1); }
      66% { transform: translate(-20px, 20px) scale(0.9); }
    }
    .animate-blob { animation: blob 7s infinite; }
    .animation-delay-2000 { animation-delay: 2s; }
    .animation-delay-4000 { animation-delay: 4s; }
    
    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOutRight {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }
    .toast-enter { animation: slideInRight 0.3s ease-out; }
    .toast-exit { animation: slideOutRight 0.3s ease-in; }
  </style>
</head>
<body class="flex items-center justify-center p-6 bg-gradient-to-r from-[#0a0a2a] to-[#2e3adf] min-h-screen">
  <!-- Toast Container -->
  <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

  <div class="relative max-w-md w-full bg-white bg-opacity-90 rounded-2xl shadow-2xl p-8 sm:p-10 overflow-hidden">
    <!-- Background blobs -->
    <div aria-hidden="true" class="absolute -top-16 -left-16 w-48 h-48 bg-blue-300 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-blob"></div>
    <div aria-hidden="true" class="absolute -bottom-20 -right-20 w-72 h-72 bg-indigo-400 rounded-full mix-blend-multiply filter blur-2xl opacity-30 animate-blob animation-delay-2000"></div>
    <div aria-hidden="true" class="absolute top-1/2 left-1/2 w-96 h-96 bg-purple-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-4000"></div>

    <div class="relative z-10 text-center mb-6">
      <div class="inline-flex items-center justify-center text-blue-600 font-extrabold text-2xl sm:text-3xl mb-1 select-none">
        <i class="fas fa-file-invoice-dollar mr-3"></i>
        <span>BudgetTrack</span>
      </div>
      <p class="text-gray-700 text-base sm:text-lg font-medium tracking-wide">
        Take control of your finances today
      </p>
    </div>

    <h2 class="relative z-10 font-extrabold text-gray-900 text-xl sm:text-2xl mb-6 select-none">
      Create a New Account
    </h2>

    <form id="signup-form" class="relative z-10" novalidate>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-5">
        <div>
          <label for="firstname" class="block text-sm font-semibold text-gray-900 mb-2">First Name</label>
          <input id="firstname" type="text" placeholder="Enter your first name" required class="w-full border rounded-lg px-4 py-3" />
        </div>
        <div>
          <label for="lastname" class="block text-sm font-semibold text-gray-900 mb-2">Last Name</label>
          <input id="lastname" type="text" placeholder="Enter your last name" required class="w-full border rounded-lg px-4 py-3" />
        </div>
      </div>

      <label for="contact" class="block text-sm font-semibold text-gray-900 mb-2">Contact Number</label>
      <input id="contact" type="tel" placeholder="Enter your contact number" required class="w-full border rounded-lg px-4 py-3 mb-5" />

      <label for="email" class="block text-sm font-semibold text-gray-900 mb-2">Email Address</label>
      <input id="email" type="email" placeholder="Enter your email" required class="w-full border rounded-lg px-4 py-3 mb-5" />

      <label for="password" class="block text-sm font-semibold text-gray-900 mb-2">Password</label>
      <input id="password" type="password" placeholder="Create a password" required class="w-full border rounded-lg px-4 py-3 mb-5" />

      <label for="confirm-password" class="block text-sm font-semibold text-gray-900 mb-2">Confirm Password</label>
      <input id="confirm-password" type="password" placeholder="Confirm your password" required class="w-full border rounded-lg px-4 py-3 mb-5" />

      <label for="currency" class="block text-sm font-semibold text-gray-900 mb-2">Preferred Currency</label>
      <select id="currency" required class="w-full border rounded-lg px-4 py-3 mb-5">
        <option value="" disabled selected>Select your currency</option>
        <option value="USD">USD - US Dollar</option>
        <option value="EUR">EUR - Euro</option>
        <option value="PHP">PHP - Philippine Peso</option>
        <option value="GBP">GBP - British Pound</option>
        <option value="JPY">JPY - Japanese Yen</option>
        <option value="AUD">AUD - Australian Dollar</option>
        <option value="CAD">CAD - Canadian Dollar</option>
        <option value="INR">INR - Indian Rupee</option>
        <option value="CNY">CNY - Chinese Yuan</option>
        <option value="KRW">KRW - South Korean Won</option>
        <option value="SGD">SGD - Singapore Dollar</option>
        <option value="THB">THB - Thai Baht</option>
        <option value="MXN">MXN - Mexican Peso</option>
        <option value="BRL">BRL - Brazilian Real</option>
      </select>

      <div class="flex items-center mb-6 text-sm">
        <input id="agree" type="checkbox" class="form-checkbox h-5 w-5 text-blue-600" />
        <label for="agree" class="ml-3 text-gray-900">I agree to the <a href="#" class="text-blue-600">Terms</a> and <a href="#" class="text-blue-600">Privacy Policy</a></label>
      </div>

      <button type="submit" id="submit-btn" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
        <span id="btn-text">Create Account</span>
        <i id="btn-spinner" class="fas fa-spinner fa-spin ml-2 hidden"></i>
      </button>

      <p class="mt-6 text-center text-gray-700 text-sm">
        Already have an account? <a href="index.html" class="text-blue-600 font-semibold hover:underline">Log in</a>
      </p>
    </form>
  </div>

  <!-- Firebase Scripts -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBk-dE1Hk-yg6sU1uilShADBohUDPlOg2o",
      authDomain: "budget-tracker-14.firebaseapp.com",
      projectId: "budget-tracker-14",
      storageBucket: "budget-tracker-14.firebasestorage.app",
      messagingSenderId: "213270821410",
      appId: "1:213270821410:web:74011269ee05d2e72e687b",
      measurementId: "G-SDLEBN6QBG"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Toast notification function
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      const toastId = 'toast-' + Date.now();
      toast.id = toastId;
      
      // Set colors based on type
      let bgColor, textColor, icon;
      switch(type) {
        case 'success':
          bgColor = 'bg-green-500';
          textColor = 'text-white';
          icon = '<i class="fas fa-check-circle mr-2"></i>';
          break;
        case 'error':
          bgColor = 'bg-red-500';
          textColor = 'text-white';
          icon = '<i class="fas fa-exclamation-circle mr-2"></i>';
          break;
        case 'warning':
          bgColor = 'bg-yellow-500';
          textColor = 'text-white';
          icon = '<i class="fas fa-exclamation-triangle mr-2"></i>';
          break;
        default:
          bgColor = 'bg-blue-500';
          textColor = 'text-white';
          icon = '<i class="fas fa-info-circle mr-2"></i>';
      }
      
      toast.className = `${bgColor} ${textColor} px-6 py-4 rounded-lg shadow-lg max-w-sm toast-enter flex items-center`;
      toast.innerHTML = `
        ${icon}
        <span class="flex-1">${message}</span>
        <button onclick="closeToast('${toastId}')" class="ml-4 hover:opacity-70">
          <i class="fas fa-times"></i>
        </button>
      `;
      
      document.getElementById('toast-container').appendChild(toast);
      
      // Auto-close after 5 seconds
      setTimeout(() => {
        closeToast(toastId);
      }, 5000);
    }

    // Close toast function
    window.closeToast = function(toastId) {
      const toast = document.getElementById(toastId);
      if (toast) {
        toast.classList.remove('toast-enter');
        toast.classList.add('toast-exit');
        setTimeout(() => {
          toast.remove();
        }, 300);
      }
    }

    const form = document.getElementById("signup-form");
    const submitBtn = document.getElementById("submit-btn");
    const btnText = document.getElementById("btn-text");
    const btnSpinner = document.getElementById("btn-spinner");

    // Function to set loading state
    function setLoadingState(isLoading) {
      if (isLoading) {
        submitBtn.disabled = true;
        btnText.textContent = "Creating...";
        btnSpinner.classList.remove("hidden");
      } else {
        submitBtn.disabled = false;
        btnText.textContent = "Create Account";
        btnSpinner.classList.add("hidden");
      }
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const firstname = document.getElementById("firstname").value.trim();
      const lastname = document.getElementById("lastname").value.trim();
      const contact = document.getElementById("contact").value.trim();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;
      const confirmPassword = document.getElementById("confirm-password").value;
      const agree = document.getElementById("agree").checked;
      const currency = document.getElementById("currency").value;

      if (!currency) {
        showToast("Please select a preferred currency.", 'warning');
        return;
      }

      if (password !== confirmPassword) {
        showToast("Passwords do not match. Please try again.", 'error');
        return;
      }

      if (!agree) {
        showToast("Please accept the terms and privacy policy to continue.", 'warning');
        return;
      }

      // Set loading state
      setLoadingState(true);

      try {
          const userCredential = await createUserWithEmailAndPassword(auth, email, password);
          const user = userCredential.user;

         // Save extra user info in Firestore
          await setDoc(doc(db, "users", user.uid), {
            uid: user.uid,
            firstname,
            lastname,
            contact,
            email,
            currency,
            createdAt: new Date()
          });

          showToast("Account successfully created! Redirecting to login...", 'success');
          form.reset();

          // Redirect after showing success message
          setTimeout(() => {
            window.location.href = "index.html";
          }, 2000);

        } catch (error) {
          console.error("Error creating account:", error.message);
          showToast("Error creating account: " + error.message, 'error');
          // Reset loading state on error
          setLoadingState(false);
        }
    });
  </script>
</body>
</html>
